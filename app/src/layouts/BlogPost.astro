---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import FormattedDate from "~/components/ui/FormattedDate.astro";

// We extend the type but make pubDate optional
type Props = Omit<CollectionEntry<"blog">["data"], "pubDate"> & {
    pubDate?: Date;
};

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<BaseLayout title={title} description={description}>
    <main>
        <article>
            {
                heroImage && (
                    <div class="hero-image">
                        <Image
                            width={1020}
                            height={510}
                            src={heroImage}
                            alt=""
                            loading="eager"
                        />
                    </div>
                )
            }

            <header class="post-header">
                <div class="date-container">
                    {pubDate && <FormattedDate date={pubDate} />}

                    {
                        updatedDate && (
                            <span class="last-updated">
                                {pubDate ? "(Updated: " : "Updated: "}
                                <FormattedDate date={updatedDate} />
                                {pubDate && ")"}
                            </span>
                        )
                    }
                </div>
                <h1>{title}</h1>
                <hr />
            </header>

            <div class="prose">
                <slot />
            </div>
        </article>
    </main>
</BaseLayout>

<style>
    main {
        flex: 1;
        width: 100%;
        max-width: 720px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .hero-image {
        margin-bottom: 2rem;
    }

    .hero-image img {
        display: block;
        border-radius: 12px;
        box-shadow: var(--box-shadow);
        width: 100%;
        height: auto;
    }

    .post-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .date-container {
        color: rgb(var(--gray));
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .last-updated {
        font-style: italic;
        font-size: 0.85rem;
        opacity: 0.8;
    }

    h1 {
        font-size: clamp(2rem, 5vw, 2.5rem);
        margin: 0.5rem 0;
        line-height: 1.2;
    }

    hr {
        border: 0;
        border-top: 1px solid rgb(var(--gray-light));
        margin: 2rem 0;
    }
</style>
